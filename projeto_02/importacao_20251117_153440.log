[0;32m[2025-11-17 15:34:40] === Iniciando importa√ß√£o dos scripts SQL ===[0m
[1;33m[2025-11-17 15:34:40] Banco de dados: biblioteca_universitaria[0m
[1;33m[2025-11-17 15:34:40] Processando: 02_biblioteca_dml.sql[0m
----------------------------------------
mysql: Deprecated program name. It will be removed in a future release, use '/usr/bin/mariadb' instead
--------------
INSERT INTO
  Categorias (nome_categoria, descricao)
VALUES
  ('Fic√ß√£o Liter√°ria', 'Romances e contos de fic√ß√£o'),
  (
    'Fic√ß√£o Cient√≠fica',
    'Literatura de fic√ß√£o cient√≠fica e fantasia'
  ),
  ('Romance', 'Romances contempor√¢neos e cl√°ssicos'),
  (
    'Tecnologia e Computa√ß√£o',
    'Livros t√©cnicos de programa√ß√£o e TI'
  ),
  ('Ci√™ncias Exatas', 'Matem√°tica, f√≠sica e qu√≠mica'),
  (
    'Ci√™ncias Humanas',
    'Sociologia, filosofia e psicologia'
  ),
  ('Hist√≥ria', 'Hist√≥ria mundial e do Brasil'),
  ('Biografia', 'Biografias e autobiografias'),
  (
    'Autoajuda',
    'Desenvolvimento pessoal e profissional'
  ),
  (
    'Refer√™ncia',
    'Dicion√°rios, enciclop√©dias e guias'
  )
--------------

Query OK, 10 rows affected (0,001 sec)
Records: 10  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Editoras (nome_editora, pais, cidade, site)
VALUES
  (
    'Companhia das Letras',
    'Brasil',
    'S√£o Paulo',
    'www.companhiadasletras.com.br'
  ),
  (
    'Editora Globo',
    'Brasil',
    'Porto Alegre',
    'www.editoraglobo.com.br'
  ),
  (
    'Aleph',
    'Brasil',
    'S√£o Paulo',
    'www.editoraaleph.com.br'
  ),
  (
    'Casa do C√≥digo',
    'Brasil',
    'S√£o Paulo',
    'www.casadocodigo.com.br'
  ),
  (
    'Penguin Random House',
    'Estados Unidos',
    'Nova York',
    'www.penguinrandomhouse.com'
  ),
  (
    'HarperCollins',
    'Reino Unido',
    'Londres',
    'www.harpercollins.co.uk'
  ),
  (
    'Planeta',
    'Espanha',
    'Barcelona',
    'www.planetadelibros.com'
  ),
  (
    'O''Reilly Media',
    'Estados Unidos',
    'Sebastopol',
    'www.oreilly.com'
  )
--------------

Query OK, 8 rows affected (0,001 sec)
Records: 8  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Autores (nome_autor, nacionalidade, data_nascimento)
VALUES
  ('Machado de Assis', 'Brasileira', '1839-06-21'),
  ('Clarice Lispector', 'Brasileira', '1920-12-10'),
  ('Paulo Coelho', 'Brasileira', '1947-08-24'),
  ('Jorge Amado', 'Brasileira', '1912-08-10'),
  ('Cec√≠lia Meireles', 'Brasileira', '1901-11-07'),
  ('George Orwell', 'Brit√¢nica', '1903-06-25'),
  ('Virginia Woolf', 'Brit√¢nica', '1882-01-25'),
  (
    'Gabriel Garc√≠a M√°rquez',
    'Colombiana',
    '1927-03-06'
  ),
  ('Isaac Asimov', 'Americana', '1920-01-02'),
  ('Arthur C. Clarke', 'Brit√¢nica', '1917-12-16'),
  ('Robert C. Martin', 'Americana', '1952-12-05'),
  ('Martin Fowler', 'Brit√¢nica', '1963-12-18'),
  ('Kent Beck', 'Americana', '1961-03-31'),
  ('Eric Evans', 'Americana', '1960-01-15'),
  ('Yuval Noah Harari', 'Israelense', '1976-02-24'),
  ('Stephen Hawking', 'Brit√¢nica', '1942-01-08'),
  ('Carl Sagan', 'Americana', '1934-11-09'),
  ('Michelle Obama', 'Americana', '1964-01-17'),
  ('Malala Yousafzai', 'Paquistanesa', '1997-07-12'),
  ('Viktor Frankl', 'Austr√≠aca', '1905-03-26')
--------------

Query OK, 20 rows affected (0,001 sec)
Records: 20  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Livros (
    isbn,
    titulo,
    ano_publicacao,
    edicao,
    numero_paginas,
    idioma,
    id_categoria,
    id_editora
  )
VALUES
  (
    '9788535908770',
    'Dom Casmurro',
    1899,
    1,
    256,
    'Portugu√™s',
    1,
    1
  ),
  (
    '9788520923146',
    'A Hora da Estrela',
    1977,
    1,
    88,
    'Portugu√™s',
    1,
    2
  ),
  (
    '9788576843849',
    'O Alquimista',
    1988,
    1,
    198,
    'Portugu√™s',
    3,
    3
  ),
  (
    '9788520923207',
    'Capit√£es da Areia',
    1937,
    1,
    280,
    'Portugu√™s',
    1,
    2
  ),
  (
    '9788535911664',
    '1984',
    1949,
    1,
    416,
    'Portugu√™s',
    2,
    1
  ),
  (
    '9788573269529',
    'A Revolu√ß√£o dos Bichos',
    1945,
    1,
    152,
    'Portugu√™s',
    2,
    1
  ),
  (
    '9788574480381',
    'Mrs. Dalloway',
    1925,
    1,
    288,
    'Portugu√™s',
    1,
    7
  ),
  (
    '9788535914849',
    'Cem Anos de Solid√£o',
    1967,
    1,
    432,
    'Portugu√™s',
    1,
    1
  ),
  (
    '9788576570486',
    'Funda√ß√£o',
    1951,
    1,
    295,
    'Portugu√™s',
    2,
    3
  ),
  (
    '9788576571278',
    '2001: Uma Odisseia no Espa√ßo',
    1968,
    1,
    336,
    'Portugu√™s',
    2,
    3
  ),
  (
    '9788576082675',
    'C√≥digo Limpo',
    2008,
    1,
    425,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788575225875',
    'Refatora√ß√£o',
    1999,
    2,
    456,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788577808670',
    'Padr√µes de Projetos',
    1994,
    1,
    364,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788575226759',
    'Domain-Driven Design',
    2003,
    1,
    560,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788535929186',
    'Sapiens: Uma Breve Hist√≥ria da Humanidade',
    2011,
    1,
    464,
    'Portugu√™s',
    7,
    1
  ),
  (
    '9788551004401',
    '21 Li√ß√µes para o S√©culo 21',
    2018,
    1,
    432,
    'Portugu√™s',
    6,
    1
  ),
  (
    '9788580578133',
    'Uma Breve Hist√≥ria do Tempo',
    1988,
    1,
    256,
    'Portugu√™s',
    5,
    2
  ),
  (
    '9788535914061',
    'Cosmos',
    1980,
    1,
    384,
    'Portugu√™s',
    5,
    1
  ),
  (
    '9788539004379',
    'Minha Hist√≥ria',
    2018,
    1,
    544,
    'Portugu√™s',
    8,
    3
  ),
  (
    '9788535930207',
    'Eu Sou Malala',
    2013,
    1,
    344,
    'Portugu√™s',
    8,
    1
  ),
  (
    '9788575428320',
    'Em Busca de Sentido',
    1946,
    1,
    184,
    'Portugu√™s',
    9,
    2
  ),
  (
    '9788576843122',
    'O Poder do H√°bito',
    2012,
    1,
    408,
    'Portugu√™s',
    9,
    3
  ),
  (
    '9788535928686',
    'Romeu e Julieta',
    1597,
    1,
    304,
    'Portugu√™s',
    1,
    1
  ),
  (
    '9788576570769',
    'O Senhor dos An√©is: A Sociedade do Anel',
    1954,
    1,
    576,
    'Portugu√™s',
    2,
    3
  ),
  (
    '9788535932447',
    'Harry Potter e a Pedra Filosofal',
    1997,
    1,
    264,
    'Portugu√™s',
    2,
    1
  ),
  (
    '9788575225134',
    'Clean Architecture',
    2017,
    1,
    432,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788575227268',
    'Microsservi√ßos Prontos Para a Produ√ß√£o',
    2016,
    1,
    280,
    'Portugu√™s',
    4,
    4
  ),
  (
    '9788535931976',
    'O Gene Ego√≠sta',
    1976,
    1,
    544,
    'Portugu√™s',
    5,
    1
  ),
  (
    '9788576655442',
    'Guia Pr√°tico SQL',
    2020,
    1,
    352,
    'Portugu√™s',
    10,
    4
  ),
  (
    '9788535924558',
    'Dicion√°rio Houaiss da L√≠ngua Portuguesa',
    2009,
    1,
    2922,
    'Portugu√™s',
    10,
    1
  )
--------------

Query OK, 30 rows affected (0,001 sec)
Records: 30  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  LivrosAutores (id_livro, id_autor, ordem_autoria)
VALUES
  (1, 1, 1),
  (2, 2, 1),
  (3, 3, 1),
  (4, 4, 1),
  (5, 6, 1),
  (6, 6, 1),
  (7, 7, 1),
  (8, 8, 1),
  (9, 9, 1),
  (10, 10, 1),
  (11, 11, 1),
  (12, 12, 1),
  (13, 12, 1),
  (13, 13, 2),
  (14, 14, 1),
  (15, 15, 1),
  (16, 15, 1),
  (17, 16, 1),
  (18, 17, 1),
  (19, 18, 1),
  (20, 19, 1),
  (21, 20, 1),
  (22, 11, 1),
  (22, 12, 2),
  (23, 1, 1),
  (24, 8, 1),
  (25, 3, 1),
  (26, 11, 1),
  (27, 12, 1),
  (27, 14, 2),
  (28, 17, 1),
  (29, 11, 1),
  (29, 13, 2),
  (29, 14, 3),
  (30, 15, 1),
  (30, 16, 2)
--------------

Query OK, 36 rows affected (0,001 sec)
Records: 36  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Exemplares (
    id_livro,
    codigo_exemplar,
    status,
    data_aquisicao,
    localizacao
  )
VALUES
  (
    1,
    'LIV-001-A',
    'Dispon√≠vel',
    '2020-01-15',
    'Prateleira A1'
  ),
  (
    1,
    'LIV-001-B',
    'Emprestado',
    '2020-01-15',
    'Prateleira A1'
  ),
  (
    2,
    'LIV-002-A',
    'Dispon√≠vel',
    '2020-02-10',
    'Prateleira A2'
  ),
  (
    3,
    'LIV-003-A',
    'Emprestado',
    '2020-03-05',
    'Prateleira A3'
  ),
  (
    3,
    'LIV-003-B',
    'Dispon√≠vel',
    '2020-03-05',
    'Prateleira A3'
  ),
  (
    4,
    'LIV-004-A',
    'Dispon√≠vel',
    '2020-04-12',
    'Prateleira A4'
  ),
  (
    5,
    'LIV-005-A',
    'Emprestado',
    '2019-05-20',
    'Prateleira B1'
  ),
  (
    5,
    'LIV-005-B',
    'Dispon√≠vel',
    '2019-05-20',
    'Prateleira B1'
  ),
  (
    5,
    'LIV-005-C',
    'Emprestado',
    '2021-05-20',
    'Prateleira B1'
  ),
  (
    6,
    'LIV-006-A',
    'Dispon√≠vel',
    '2019-06-15',
    'Prateleira B2'
  ),
  (
    7,
    'LIV-007-A',
    'Emprestado',
    '2020-07-22',
    'Prateleira B3'
  ),
  (
    8,
    'LIV-008-A',
    'Dispon√≠vel',
    '2020-08-18',
    'Prateleira B4'
  ),
  (
    9,
    'LIV-009-A',
    'Emprestado',
    '2021-01-10',
    'Prateleira C1'
  ),
  (
    10,
    'LIV-010-A',
    'Dispon√≠vel',
    '2021-02-14',
    'Prateleira C2'
  ),
  (
    11,
    'LIV-011-A',
    'Emprestado',
    '2021-03-20',
    'Prateleira C3'
  ),
  (
    11,
    'LIV-011-B',
    'Emprestado',
    '2021-03-20',
    'Prateleira C3'
  ),
  (
    11,
    'LIV-011-C',
    'Dispon√≠vel',
    '2022-03-20',
    'Prateleira C3'
  ),
  (
    12,
    'LIV-012-A',
    'Dispon√≠vel',
    '2021-04-25',
    'Prateleira C4'
  ),
  (
    12,
    'LIV-012-B',
    'Emprestado',
    '2021-04-25',
    'Prateleira C4'
  ),
  (
    13,
    'LIV-013-A',
    'Dispon√≠vel',
    '2021-05-30',
    'Prateleira D1'
  ),
  (
    14,
    'LIV-014-A',
    'Emprestado',
    '2021-06-15',
    'Prateleira D2'
  ),
  (
    14,
    'LIV-014-B',
    'Dispon√≠vel',
    '2021-06-15',
    'Prateleira D2'
  ),
  (
    15,
    'LIV-015-A',
    'Emprestado',
    '2022-01-10',
    'Prateleira D3'
  ),
  (
    15,
    'LIV-015-B',
    'Dispon√≠vel',
    '2022-01-10',
    'Prateleira D3'
  ),
  (
    16,
    'LIV-016-A',
    'Dispon√≠vel',
    '2022-02-20',
    'Prateleira D4'
  ),
  (
    17,
    'LIV-017-A',
    'Emprestado',
    '2022-03-15',
    'Prateleira E1'
  ),
  (
    18,
    'LIV-018-A',
    'Dispon√≠vel',
    '2022-04-22',
    'Prateleira E2'
  ),
  (
    19,
    'LIV-019-A',
    'Emprestado',
    '2022-05-30',
    'Prateleira E3'
  ),
  (
    20,
    'LIV-020-A',
    'Dispon√≠vel',
    '2022-06-18',
    'Prateleira E4'
  ),
  (
    21,
    'LIV-021-A',
    'Emprestado',
    '2022-07-25',
    'Prateleira F1'
  ),
  (
    22,
    'LIV-022-A',
    'Dispon√≠vel',
    '2022-08-14',
    'Prateleira F2'
  ),
  (
    23,
    'LIV-023-A',
    'Manuten√ß√£o',
    '2019-09-20',
    'Prateleira F3'
  ),
  (
    24,
    'LIV-024-A',
    'Emprestado',
    '2023-01-10',
    'Prateleira F4'
  ),
  (
    24,
    'LIV-024-B',
    'Reservado',
    '2023-01-10',
    'Prateleira F4'
  ),
  (
    25,
    'LIV-025-A',
    'Emprestado',
    '2023-02-15',
    'Prateleira G1'
  ),
  (
    25,
    'LIV-025-B',
    'Dispon√≠vel',
    '2023-02-15',
    'Prateleira G1'
  ),
  (
    26,
    'LIV-026-A',
    'Dispon√≠vel',
    '2023-03-20',
    'Prateleira G2'
  ),
  (
    27,
    'LIV-027-A',
    'Emprestado',
    '2023-04-25',
    'Prateleira G3'
  ),
  (
    28,
    'LIV-028-A',
    'Dispon√≠vel',
    '2023-05-30',
    'Prateleira G4'
  ),
  (
    29,
    'LIV-029-A',
    'Manuten√ß√£o',
    '2023-06-15',
    'Prateleira H1'
  ),
  (
    29,
    'LIV-029-B',
    'Dispon√≠vel',
    '2023-06-15',
    'Prateleira H1'
  ),
  (
    30,
    'LIV-030-A',
    'Dispon√≠vel',
    '2023-07-20',
    'Prateleira H2'
  ),
  (
    30,
    'LIV-030-B',
    'Manuten√ß√£o',
    '2023-07-20',
    'Prateleira H2'
  ),
  (
    1,
    'LIV-001-C',
    'Reservado',
    '2023-08-10',
    'Prateleira A1'
  ),
  (
    11,
    'LIV-011-D',
    'Emprestado',
    '2024-01-15',
    'Prateleira C3'
  ),
  (
    15,
    'LIV-015-C',
    'Emprestado',
    '2024-02-20',
    'Prateleira D3'
  ),
  (
    5,
    'LIV-005-D',
    'Dispon√≠vel',
    '2024-03-10',
    'Prateleira B1'
  ),
  (
    12,
    'LIV-012-C',
    'Dispon√≠vel',
    '2024-04-05',
    'Prateleira C4'
  ),
  (
    14,
    'LIV-014-C',
    'Dispon√≠vel',
    '2024-05-12',
    'Prateleira D2'
  ),
  (
    24,
    'LIV-024-C',
    'Dispon√≠vel',
    '2024-06-18',
    'Prateleira F4'
  )
--------------

Query OK, 50 rows affected (0,002 sec)
Records: 50  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Usuarios (
    cpf,
    nome_completo,
    email,
    telefone,
    id_tipo_usuario,
    status
  )
VALUES
  (
    '12345678901',
    'Jo√£o Silva Santos',
    'joao.silva@email.com',
    '11987654321',
    1,
    'Ativo'
  ),
  (
    '23456789012',
    'Maria Oliveira Costa',
    'maria.oliveira@email.com',
    '11876543210',
    1,
    'Ativo'
  ),
  (
    '34567890123',
    'Carlos Alberto Souza',
    'carlos.souza@email.com',
    '11765432109',
    2,
    'Ativo'
  ),
  (
    '45678901234',
    'Ana Paula Ferreira',
    'ana.ferreira@email.com',
    '11654321098',
    1,
    'Ativo'
  ),
  (
    '56789012345',
    'Pedro Henrique Lima',
    'pedro.lima@email.com',
    '11543210987',
    1,
    'Ativo'
  ),
  (
    '67890123456',
    'Juliana Rodrigues Alves',
    'juliana.alves@email.com',
    '11432109876',
    2,
    'Ativo'
  ),
  (
    '78901234567',
    'Fernando Costa Martins',
    'fernando.martins@email.com',
    '11321098765',
    1,
    'Ativo'
  ),
  (
    '89012345678',
    'Beatriz Santos Pereira',
    'beatriz.pereira@email.com',
    '11210987654',
    1,
    'Ativo'
  ),
  (
    '90123456789',
    'Rafael Oliveira Barbosa',
    'rafael.barbosa@email.com',
    '11109876543',
    3,
    'Ativo'
  ),
  (
    '01234567890',
    'Camila Souza Mendes',
    'camila.mendes@email.com',
    '11998765432',
    1,
    'Ativo'
  ),
  (
    '11223344556',
    'Lucas Fernandes Rocha',
    'lucas.rocha@email.com',
    '11887766554',
    1,
    'Ativo'
  ),
  (
    '22334455667',
    'Patricia Lima Cardoso',
    'patricia.cardoso@email.com',
    '11776655443',
    2,
    'Ativo'
  ),
  (
    '33445566778',
    'Ricardo Almeida Nunes',
    'ricardo.nunes@email.com',
    '11665544332',
    1,
    'Suspenso'
  ),
  (
    '44556677889',
    'Fernanda Costa Ribeiro',
    'fernanda.ribeiro@email.com',
    '11554433221',
    1,
    'Ativo'
  ),
  (
    '55667788990',
    'Gustavo Santos Dias',
    'gustavo.dias@email.com',
    '11443322110',
    2,
    'Ativo'
  ),
  (
    '66778899001',
    'Amanda Pereira Gomes',
    'amanda.gomes@email.com',
    '11332211009',
    1,
    'Ativo'
  ),
  (
    '77889900112',
    'Bruno Oliveira Castro',
    'bruno.castro@email.com',
    '11221100998',
    3,
    'Ativo'
  ),
  (
    '88990011223',
    'Larissa Rodrigues Silva',
    'larissa.silva@email.com',
    '11110099887',
    1,
    'Ativo'
  ),
  (
    '99001122334',
    'Thiago Alves Monteiro',
    'thiago.monteiro@email.com',
    '11009988776',
    2,
    'Ativo'
  ),
  (
    '10111213141',
    'Vanessa Lima Teixeira',
    'vanessa.teixeira@email.com',
    '11998877665',
    1,
    'Ativo'
  ),
  (
    '20212223242',
    'Diego Souza Ara√∫jo',
    'diego.araujo@email.com',
    '11887766554',
    3,
    'Ativo'
  ),
  (
    '30313233343',
    'Tatiana Costa Moreira',
    'tatiana.moreira@email.com',
    '11776655443',
    2,
    'Ativo'
  ),
  (
    '40414243444',
    'Marcelo Santos Vieira',
    'marcelo.vieira@email.com',
    '11665544332',
    1,
    'Suspenso'
  ),
  (
    '50515253545',
    'Gabriela Ferreira Cunha',
    'gabriela.cunha@email.com',
    '11554433221',
    1,
    'Ativo'
  ),
  (
    '60616263646',
    'Rodrigo Almeida Pinto',
    'rodrigo.pinto@email.com',
    '11443322110',
    1,
    'Inativo'
  )
--------------

Query OK, 25 rows affected (0,001 sec)
Records: 25  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Emprestimos (
    id_usuario,
    id_exemplar,
    data_emprestimo,
    data_prevista_devolucao,
    data_devolucao_real,
    status_emprestimo
  )
VALUES
  (
    1,
    2,
    '2025-09-01 10:00:00',
    '2025-09-15',
    '2025-09-14 14:30:00',
    'Devolvido'
  ),
  (
    2,
    7,
    '2025-09-05 11:00:00',
    '2025-09-19',
    '2025-09-24 16:00:00', 
    'Devolvido'
  ),
  (
    4,
    11,
    '2025-09-10 09:30:00',
    '2025-09-24',
    '2025-09-23 10:00:00',
    'Devolvido'
  ),
  (
    5,
    17,
    '2025-09-12 14:00:00',
    '2025-09-26',
    '2025-09-27 15:30:00',
    'Devolvido'
  ),
  (
    7,
    23,
    '2025-09-15 10:30:00',
    '2025-09-29',
    '2025-10-03 11:00:00', 
    'Devolvido'
  ),
  (
    8,
    28,
    '2025-09-18 13:00:00',
    '2025-10-02',
    '2025-10-01 14:00:00',
    'Devolvido'
  ),
  (
    10,
    33,
    '2025-09-20 15:00:00',
    '2025-10-04',
    '2025-10-03 16:30:00',
    'Devolvido'
  ),
  (
    11,
    38,
    '2025-09-22 09:00:00',
    '2025-10-06',
    '2025-10-05 10:00:00',
    'Devolvido'
  ),
  (
    14,
    19,
    '2025-09-25 11:30:00',
    '2025-10-09',
    '2025-10-12 12:00:00', 
    'Devolvido'
  ),
  (
    16,
    24,
    '2025-09-28 14:30:00',
    '2025-10-12',
    '2025-10-11 15:00:00',
    'Devolvido'
  ),
  (
    18,
    30,
    '2025-10-01 10:00:00',
    '2025-10-15',
    '2025-10-14 11:00:00',
    'Devolvido'
  ),
  (
    20,
    36,
    '2025-10-03 13:00:00',
    '2025-10-17',
    '2025-10-16 14:00:00',
    'Devolvido'
  ),
  (
    1,
    41,
    '2025-10-05 09:30:00',
    '2025-10-19',
    '2025-10-18 10:30:00',
    'Devolvido'
  ),
  (
    3,
    48,
    '2025-10-08 15:00:00',
    '2025-11-07',
    '2025-10-22 16:00:00',
    'Devolvido'
  ),
  (
    6,
    50,
    '2025-10-10 11:00:00',
    '2025-11-09',
    '2025-10-24 12:00:00',
    'Devolvido'
  )
--------------

Query OK, 15 rows affected (0,001 sec)
Records: 15  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Emprestimos (
    id_usuario,
    id_exemplar,
    data_emprestimo,
    data_prevista_devolucao,
    data_devolucao_real,
    status_emprestimo
  )
VALUES
  (
    2,
    4,
    '2025-11-05 10:00:00',
    '2025-11-19',
    NULL,
    'Ativo'
  ),
  (
    5,
    9,
    '2025-11-06 11:00:00',
    '2025-11-20',
    NULL,
    'Ativo'
  ),
  (
    7,
    16,
    '2025-11-07 09:30:00',
    '2025-11-21',
    NULL,
    'Ativo'
  ),
  (
    10,
    21,
    '2025-11-08 14:00:00',
    '2025-11-22',
    NULL,
    'Ativo'
  ),
  (
    11,
    25,
    '2025-11-09 10:30:00',
    '2025-11-23',
    NULL,
    'Ativo'
  ),
  (
    14,
    35,
    '2025-11-10 13:00:00',
    '2025-11-24',
    NULL,
    'Ativo'
  ),
  (
    16,
    45,
    '2025-11-11 15:00:00',
    '2025-11-25',
    NULL,
    'Ativo'
  ),
  (
    18,
    15,
    '2025-11-12 09:00:00',
    '2025-11-26',
    NULL,
    'Ativo'
  ),
  (
    3,
    46,
    '2025-11-13 11:30:00',
    '2025-12-13',
    NULL,
    'Ativo'
  ),
  (
    6,
    27,
    '2025-11-14 14:30:00',
    '2025-12-14',
    NULL,
    'Ativo'
  )
--------------

Query OK, 10 rows affected (0,001 sec)
Records: 10  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Emprestimos (
    id_usuario,
    id_exemplar,
    data_emprestimo,
    data_prevista_devolucao,
    data_devolucao_real,
    status_emprestimo
  )
VALUES
  (
    13,
    3,
    '2025-10-01 10:00:00',
    '2025-10-15',
    NULL,
    'Atrasado'
  ),
  (
    23,
    5,
    '2025-10-05 11:00:00',
    '2025-10-19',
    NULL,
    'Atrasado'
  ),
  (
    4,
    14,
    '2025-10-08 09:30:00',
    '2025-10-22',
    NULL,
    'Atrasado'
  ),
  (
    8,
    19,
    '2025-10-10 14:00:00',
    '2025-10-24',
    NULL,
    'Atrasado'
  ),
  (
    1,
    37,
    '2025-10-12 10:30:00',
    '2025-10-26',
    NULL,
    'Atrasado'
  )
--------------

Query OK, 5 rows affected (0,000 sec)
Records: 5  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Multas (
    id_emprestimo,
    valor_multa,
    dias_atraso,
    data_geracao,
    status_pagamento,
    data_pagamento
  )
VALUES
  (26, 62.00, 31, '2025-10-16 10:00:00', 'Pendente', NULL), 
  (27, 54.00, 27, '2025-10-20 10:00:00', 'Pendente', NULL), 
  (28, 48.00, 24, '2025-10-23 10:00:00', 'Pendente', NULL), 
  (29, 44.00, 22, '2025-10-25 10:00:00', 'Pendente', NULL), 
  (30, 40.00, 20, '2025-10-27 10:00:00', 'Pendente', NULL)
--------------

Query OK, 5 rows affected (0,001 sec)
Records: 5  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Multas (
    id_emprestimo,
    valor_multa,
    dias_atraso,
    data_geracao,
    status_pagamento,
    data_pagamento
  )
VALUES
  (2, 10.00, 5, '2025-09-20 10:00:00', 'Pago', '2025-10-05 10:00:00'), 
  (5, 8.00, 4, '2025-09-30 10:00:00', 'Pago', '2025-10-10 11:00:00'), 
  (9, 6.00, 3, '2025-10-09 10:00:00', 'Pago', '2025-10-15 14:00:00')
--------------

Query OK, 3 rows affected (0,000 sec)
Records: 3  Duplicates: 0  Warnings: 0

--------------
INSERT INTO
  Reservas (
    id_usuario,
    id_livro,
    data_reserva,
    status_reserva,
    data_validade
  )
VALUES
  (
    13,
    11,
    '2025-11-10 10:00:00',
    'Ativa',
    '2025-11-17'
  ), 
  (
    23,
    15,
    '2025-11-11 11:00:00',
    'Ativa',
    '2025-11-18'
  ), 
  (
    4,
    24,
    '2025-11-12 09:30:00',
    'Ativa',
    '2025-11-19'
  ), 
  (
    20,
    5,
    '2025-11-01 14:00:00',
    'Atendida',
    '2025-11-08'
  ), 
  (
    24,
    1,
    '2025-10-20 10:30:00',
    'Expirada',
    '2025-10-27'
  )
--------------

Query OK, 5 rows affected (0,001 sec)
Records: 5  Duplicates: 0  Warnings: 0

Bye
[0;32m[2025-11-17 15:34:41] ‚úì 02_biblioteca_dml.sql importado com sucesso[0m

[1;33m[2025-11-17 15:34:41] Processando: 03_biblioteca_procedures.sql[0m
----------------------------------------
mysql: Deprecated program name. It will be removed in a future release, use '/usr/bin/mariadb' instead
--------------
DROP PROCEDURE IF EXISTS sp_RealizarEmprestimo
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE PROCEDURE sp_RealizarEmprestimo(
    IN p_id_usuario INT,
    IN p_id_exemplar INT,
    OUT p_sucesso BOOLEAN,
    OUT p_mensagem VARCHAR(200)
)
sp_RealizarEmprestimo: BEGIN
    DECLARE v_status_usuario VARCHAR(20);
    DECLARE v_multas_pendentes INT;
    DECLARE v_emprestimos_ativos INT;
    DECLARE v_max_emprestimos INT;
    DECLARE v_prazo_dias INT;
    DECLARE v_status_exemplar VARCHAR(20);
    DECLARE v_data_prevista DATE;

    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Erro ao processar empr√©stimo';
    END;

    START TRANSACTION;

    
    SELECT status INTO v_status_usuario
    FROM Usuarios
    WHERE id_usuario = p_id_usuario;

    IF v_status_usuario IS NULL THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Usu√°rio n√£o encontrado';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    IF v_status_usuario != 'Ativo' THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Usu√°rio n√£o est√° ativo';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    
    SELECT COUNT(*) INTO v_multas_pendentes
    FROM Multas m
    JOIN Emprestimos e ON m.id_emprestimo = e.id_emprestimo
    WHERE e.id_usuario = p_id_usuario
    AND m.status_pagamento = 'Pendente';

    IF v_multas_pendentes > 0 THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Usu√°rio possui multas pendentes';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    
    SELECT COUNT(*) INTO v_emprestimos_ativos
    FROM Emprestimos
    WHERE id_usuario = p_id_usuario
    AND status_emprestimo = 'Ativo';

    SELECT tu.max_emprestimos, tu.prazo_dias
    INTO v_max_emprestimos, v_prazo_dias
    FROM TiposUsuario tu
    JOIN Usuarios u ON u.id_tipo_usuario = tu.id_tipo_usuario
    WHERE u.id_usuario = p_id_usuario;

    IF v_emprestimos_ativos >= v_max_emprestimos THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Limite de empr√©stimos simult√¢neos atingido';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    
    SELECT status INTO v_status_exemplar
    FROM Exemplares
    WHERE id_exemplar = p_id_exemplar;

    IF v_status_exemplar IS NULL THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Exemplar n√£o encontrado';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    IF v_status_exemplar != 'Dispon√≠vel' THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Exemplar n√£o est√° dispon√≠vel';
        ROLLBACK;
        LEAVE sp_RealizarEmprestimo;
    END IF;

    
    SET v_data_prevista = DATE_ADD(CURDATE(), INTERVAL v_prazo_dias DAY);

    
    INSERT INTO Emprestimos (id_usuario, id_exemplar, data_emprestimo, data_prevista_devolucao, status_emprestimo)
    VALUES (p_id_usuario, p_id_exemplar, NOW(), v_data_prevista, 'Ativo');

    
    UPDATE Exemplares
    SET status = 'Emprestado'
    WHERE id_exemplar = p_id_exemplar;

    COMMIT;

    SET p_sucesso = TRUE;
    SET p_mensagem = CONCAT('Empr√©stimo realizado com sucesso. Devolu√ß√£o prevista: ', v_data_prevista);

END sp_RealizarEmprestimo
--------------

Query OK, 0 rows affected (0,044 sec)

--------------
DROP PROCEDURE IF EXISTS sp_RealizarDevolucao
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE PROCEDURE sp_RealizarDevolucao(
    IN p_id_emprestimo INT,
    OUT p_sucesso BOOLEAN,
    OUT p_valor_multa DECIMAL(10,2),
    OUT p_mensagem VARCHAR(200)
)
sp_RealizarDevolucao: BEGIN
    DECLARE v_status_emprestimo VARCHAR(20);
    DECLARE v_id_exemplar INT;
    DECLARE v_id_livro INT;
    DECLARE v_data_prevista DATE;
    DECLARE v_dias_atraso INT;
    DECLARE v_tem_reserva INT;

    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Erro ao processar devolu√ß√£o';
    END;

    START TRANSACTION;

    
    SELECT status_emprestimo, id_exemplar, data_prevista_devolucao
    INTO v_status_emprestimo, v_id_exemplar, v_data_prevista
    FROM Emprestimos
    WHERE id_emprestimo = p_id_emprestimo;

    IF v_status_emprestimo IS NULL THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Empr√©stimo n√£o encontrado';
        ROLLBACK;
        LEAVE sp_RealizarDevolucao;
    END IF;

    IF v_status_emprestimo != 'Ativo' THEN
        SET p_sucesso = FALSE;
        SET p_mensagem = 'Empr√©stimo n√£o est√° ativo';
        ROLLBACK;
        LEAVE sp_RealizarDevolucao;
    END IF;

    
    UPDATE Emprestimos
    SET data_devolucao_real = NOW()
    WHERE id_emprestimo = p_id_emprestimo;

    
    SET v_dias_atraso = DATEDIFF(CURDATE(), v_data_prevista);

    
    IF v_dias_atraso > 0 THEN
        SET p_valor_multa = v_dias_atraso * 2.00;

        
        INSERT INTO Multas (id_emprestimo, valor_multa, dias_atraso, status_pagamento)
        VALUES (p_id_emprestimo, p_valor_multa, v_dias_atraso, 'Pendente');

        
        UPDATE Emprestimos
        SET status_emprestimo = 'Atrasado'
        WHERE id_emprestimo = p_id_emprestimo;

        SET p_mensagem = CONCAT('Devolu√ß√£o com atraso. Multa: R$ ', p_valor_multa);
    ELSE
        SET p_valor_multa = 0.00;

        
        UPDATE Emprestimos
        SET status_emprestimo = 'Devolvido'
        WHERE id_emprestimo = p_id_emprestimo;

        SET p_mensagem = 'Devolu√ß√£o realizada sem atraso';
    END IF;

    
    SELECT id_livro INTO v_id_livro
    FROM Exemplares
    WHERE id_exemplar = v_id_exemplar;

    
    SELECT COUNT(*) INTO v_tem_reserva
    FROM Reservas
    WHERE id_livro = v_id_livro
    AND status_reserva = 'Ativa'
    LIMIT 1;

    
    IF v_tem_reserva > 0 THEN
        UPDATE Exemplares
        SET status = 'Reservado'
        WHERE id_exemplar = v_id_exemplar;

        SET p_mensagem = CONCAT(p_mensagem, '. Exemplar reservado para pr√≥ximo usu√°rio');
    ELSE
        UPDATE Exemplares
        SET status = 'Dispon√≠vel'
        WHERE id_exemplar = v_id_exemplar;
    END IF;

    COMMIT;

    SET p_sucesso = TRUE;

END sp_RealizarDevolucao
--------------

Query OK, 0 rows affected (0,003 sec)

--------------
DROP PROCEDURE IF EXISTS sp_CalcularMultasAtrasadas
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE PROCEDURE sp_CalcularMultasAtrasadas(
    OUT p_total_multas_geradas INT,
    OUT p_valor_total DECIMAL(10,2)
)
BEGIN
    DECLARE v_done INT DEFAULT FALSE;
    DECLARE v_id_emprestimo INT;
    DECLARE v_data_prevista DATE;
    DECLARE v_dias_atraso INT;
    DECLARE v_valor_multa DECIMAL(10,2);
    DECLARE v_multa_existe INT;

    
    DECLARE cur_atrasados CURSOR FOR
        SELECT id_emprestimo, data_prevista_devolucao
        FROM Emprestimos
        WHERE status_emprestimo = 'Ativo'
        AND data_prevista_devolucao < CURDATE();

    DECLARE CONTINUE HANDLER FOR NOT FOUND SET v_done = TRUE;

    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_total_multas_geradas = 0;
        SET p_valor_total = 0.00;
    END;

    START TRANSACTION;

    SET p_total_multas_geradas = 0;
    SET p_valor_total = 0.00;

    OPEN cur_atrasados;

    loop_atrasados: LOOP
        FETCH cur_atrasados INTO v_id_emprestimo, v_data_prevista;

        IF v_done THEN
            LEAVE loop_atrasados;
        END IF;

        
        SELECT COUNT(*) INTO v_multa_existe
        FROM Multas
        WHERE id_emprestimo = v_id_emprestimo;

        
        IF v_multa_existe = 0 THEN
            SET v_dias_atraso = DATEDIFF(CURDATE(), v_data_prevista);
            SET v_valor_multa = v_dias_atraso * 2.00;

            
            INSERT INTO Multas (id_emprestimo, valor_multa, dias_atraso, status_pagamento)
            VALUES (v_id_emprestimo, v_valor_multa, v_dias_atraso, 'Pendente');

            
            UPDATE Emprestimos
            SET status_emprestimo = 'Atrasado'
            WHERE id_emprestimo = v_id_emprestimo;

            
            SET p_total_multas_geradas = p_total_multas_geradas + 1;
            SET p_valor_total = p_valor_total + v_valor_multa;
        END IF;

    END LOOP;

    CLOSE cur_atrasados;

    COMMIT;

END
--------------

Query OK, 0 rows affected (0,003 sec)

--------------
DROP PROCEDURE IF EXISTS sp_RelatorioLivrosMaisEmprestados
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE PROCEDURE sp_RelatorioLivrosMaisEmprestados(
    IN p_data_inicio DATE,
    IN p_data_fim DATE,
    IN p_limite INT
)
BEGIN
    SELECT
        @posicao := @posicao + 1 AS posicao,
        l.isbn,
        l.titulo,
        c.nome_categoria,
        COUNT(e.id_emprestimo) AS total_emprestimos,
        (SELECT COUNT(*) FROM Exemplares WHERE id_livro = l.id_livro) AS total_exemplares
    FROM
        Emprestimos e
        JOIN Exemplares ex ON e.id_exemplar = ex.id_exemplar
        JOIN Livros l ON ex.id_livro = l.id_livro
        JOIN Categorias c ON l.id_categoria = c.id_categoria
        CROSS JOIN (SELECT @posicao := 0) AS pos_init
    WHERE
        DATE(e.data_emprestimo) BETWEEN p_data_inicio AND p_data_fim
    GROUP BY
        l.id_livro, l.isbn, l.titulo, c.nome_categoria
    ORDER BY
        total_emprestimos DESC
    LIMIT p_limite;

END
--------------

Query OK, 0 rows affected (0,002 sec)

Bye
[0;32m[2025-11-17 15:34:42] ‚úì 03_biblioteca_procedures.sql importado com sucesso[0m

[1;33m[2025-11-17 15:34:42] Processando: 04_biblioteca_triggers.sql[0m
----------------------------------------
mysql: Deprecated program name. It will be removed in a future release, use '/usr/bin/mariadb' instead
--------------
DROP TRIGGER IF EXISTS trg_ValidarDisponibilidadeEmprestimo
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_ValidarDisponibilidadeEmprestimo
BEFORE INSERT ON Emprestimos
FOR EACH ROW
BEGIN
    DECLARE v_status VARCHAR(20);

    SELECT status INTO v_status
    FROM Exemplares
    WHERE id_exemplar = NEW.id_exemplar;

    IF v_status IS NULL THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Exemplar n√£o encontrado';
    END IF;

    IF v_status != 'Dispon√≠vel' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Exemplar n√£o est√° dispon√≠vel para empr√©stimo';
    END IF;
END
--------------

Query OK, 0 rows affected (0,003 sec)

--------------
DROP TRIGGER IF EXISTS trg_ValidarLimiteEmprestimos
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_ValidarLimiteEmprestimos
BEFORE INSERT ON Emprestimos
FOR EACH ROW
BEGIN
    DECLARE v_emprestimos_ativos INT;
    DECLARE v_max_emprestimos INT;

    
    SELECT COUNT(*) INTO v_emprestimos_ativos
    FROM Emprestimos
    WHERE id_usuario = NEW.id_usuario
    AND status_emprestimo = 'Ativo';

    
    SELECT tu.max_emprestimos INTO v_max_emprestimos
    FROM TiposUsuario tu
    JOIN Usuarios u ON u.id_tipo_usuario = tu.id_tipo_usuario
    WHERE u.id_usuario = NEW.id_usuario;

    IF v_emprestimos_ativos >= v_max_emprestimos THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Limite de empr√©stimos simult√¢neos atingido';
    END IF;
END
--------------

Query OK, 0 rows affected (0,004 sec)

--------------
DROP TRIGGER IF EXISTS trg_ValidarMultasAntesEmprestimo
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_ValidarMultasAntesEmprestimo
BEFORE INSERT ON Emprestimos
FOR EACH ROW
BEGIN
    DECLARE v_multas_pendentes INT;

    SELECT COUNT(*) INTO v_multas_pendentes
    FROM Multas m
    JOIN Emprestimos e ON m.id_emprestimo = e.id_emprestimo
    WHERE e.id_usuario = NEW.id_usuario
    AND m.status_pagamento = 'Pendente';

    IF v_multas_pendentes > 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Usu√°rio possui multas pendentes';
    END IF;
END
--------------

Query OK, 0 rows affected (0,004 sec)

--------------
DROP TRIGGER IF EXISTS trg_ValidarStatusUsuario
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_ValidarStatusUsuario
BEFORE INSERT ON Emprestimos
FOR EACH ROW
BEGIN
    DECLARE v_status_usuario VARCHAR(20);

    SELECT status INTO v_status_usuario
    FROM Usuarios
    WHERE id_usuario = NEW.id_usuario;

    IF v_status_usuario != 'Ativo' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Usu√°rio n√£o est√° ativo no sistema';
    END IF;
END
--------------

Query OK, 0 rows affected (0,005 sec)

--------------
DROP TRIGGER IF EXISTS trg_PrevenirDeleteComEmprestimo
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_PrevenirDeleteComEmprestimo
BEFORE DELETE ON Exemplares
FOR EACH ROW
BEGIN
    DECLARE v_emprestimos_ativos INT;

    SELECT COUNT(*) INTO v_emprestimos_ativos
    FROM Emprestimos
    WHERE id_exemplar = OLD.id_exemplar
    AND status_emprestimo = 'Ativo';

    IF v_emprestimos_ativos > 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'N√£o √© poss√≠vel excluir exemplar com empr√©stimos ativos';
    END IF;
END
--------------

Query OK, 0 rows affected (0,009 sec)

--------------
DROP TRIGGER IF EXISTS trg_AtualizarStatusExemplar_AposEmprestimo
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_AtualizarStatusExemplar_AposEmprestimo
AFTER INSERT ON Emprestimos
FOR EACH ROW
BEGIN
    UPDATE Exemplares
    SET status = 'Emprestado'
    WHERE id_exemplar = NEW.id_exemplar;
END
--------------

Query OK, 0 rows affected (0,004 sec)

--------------
DROP TRIGGER IF EXISTS trg_AtualizarStatusExemplar_AposDevolucao
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_AtualizarStatusExemplar_AposDevolucao
AFTER UPDATE ON Emprestimos
FOR EACH ROW
BEGIN
    DECLARE v_tem_reserva INT;
    DECLARE v_id_livro INT;

    
    IF OLD.data_devolucao_real IS NULL AND NEW.data_devolucao_real IS NOT NULL THEN

        
        SELECT id_livro INTO v_id_livro
        FROM Exemplares
        WHERE id_exemplar = NEW.id_exemplar;

        
        SELECT COUNT(*) INTO v_tem_reserva
        FROM Reservas
        WHERE id_livro = v_id_livro
        AND status_reserva = 'Ativa'
        LIMIT 1;

        
        IF v_tem_reserva > 0 THEN
            UPDATE Exemplares
            SET status = 'Reservado'
            WHERE id_exemplar = NEW.id_exemplar;
        ELSE
            UPDATE Exemplares
            SET status = 'Dispon√≠vel'
            WHERE id_exemplar = NEW.id_exemplar;
        END IF;
    END IF;
END
--------------

Query OK, 0 rows affected (0,004 sec)

--------------
DROP TABLE IF EXISTS LogUsuarios
--------------

Query OK, 0 rows affected, 1 warning (0,002 sec)

--------------
CREATE TABLE LogUsuarios (
    id_log INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT,
    campo_alterado VARCHAR(50),
    valor_antigo TEXT,
    valor_novo TEXT,
    data_alteracao DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB
--------------

Query OK, 0 rows affected (0,003 sec)

--------------
DROP TRIGGER IF EXISTS trg_LogAlteracaoUsuario
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE TRIGGER trg_LogAlteracaoUsuario
AFTER UPDATE ON Usuarios
FOR EACH ROW
BEGIN
    
    IF OLD.email != NEW.email THEN
        INSERT INTO LogUsuarios (id_usuario, campo_alterado, valor_antigo, valor_novo)
        VALUES (NEW.id_usuario, 'email', OLD.email, NEW.email);
    END IF;

    
    IF OLD.telefone != NEW.telefone OR (OLD.telefone IS NULL AND NEW.telefone IS NOT NULL) THEN
        INSERT INTO LogUsuarios (id_usuario, campo_alterado, valor_antigo, valor_novo)
        VALUES (NEW.id_usuario, 'telefone', OLD.telefone, NEW.telefone);
    END IF;

    
    IF OLD.status != NEW.status THEN
        INSERT INTO LogUsuarios (id_usuario, campo_alterado, valor_antigo, valor_novo)
        VALUES (NEW.id_usuario, 'status', OLD.status, NEW.status);
    END IF;
END
--------------

Query OK, 0 rows affected (0,003 sec)

Bye
[0;32m[2025-11-17 15:34:43] ‚úì 04_biblioteca_triggers.sql importado com sucesso[0m

[1;33m[2025-11-17 15:34:43] Processando: 05_biblioteca_views.sql[0m
----------------------------------------
mysql: Deprecated program name. It will be removed in a future release, use '/usr/bin/mariadb' instead
--------------
DROP VIEW IF EXISTS vw_EmprestimosAtivos
--------------

Query OK, 0 rows affected, 1 warning (0,039 sec)

--------------
CREATE OR REPLACE VIEW vw_EmprestimosAtivos AS
SELECT
    e.id_emprestimo,
    u.cpf AS cpf_usuario,
    u.nome_completo AS nome_usuario,
    tu.nome_tipo AS tipo_usuario,
    l.isbn,
    l.titulo AS titulo_livro,
    ex.codigo_exemplar,
    e.data_emprestimo,
    e.data_prevista_devolucao,
    DATEDIFF(e.data_prevista_devolucao, CURDATE()) AS dias_restantes,
    CASE
        WHEN DATEDIFF(CURDATE(), e.data_prevista_devolucao) > 0 THEN
            CONCAT('Atrasado ', DATEDIFF(CURDATE(), e.data_prevista_devolucao), ' dias')
        WHEN DATEDIFF(CURDATE(), e.data_prevista_devolucao) = 0 THEN 'Vence Hoje'
        ELSE 'No Prazo'
    END AS situacao
FROM
    Emprestimos e
    INNER JOIN Usuarios u ON e.id_usuario = u.id_usuario
    INNER JOIN TiposUsuario tu ON u.id_tipo_usuario = tu.id_tipo_usuario
    INNER JOIN Exemplares ex ON e.id_exemplar = ex.id_exemplar
    INNER JOIN Livros l ON ex.id_livro = l.id_livro
WHERE
    e.status_emprestimo = 'Ativo'
ORDER BY
    e.data_prevista_devolucao ASC
--------------

Query OK, 0 rows affected (0,005 sec)

--------------
DROP VIEW IF EXISTS vw_LivrosDisponiveis
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE OR REPLACE VIEW vw_LivrosDisponiveis AS
SELECT
    l.id_livro,
    l.isbn,
    l.titulo,
    GROUP_CONCAT(a.nome_autor ORDER BY la.ordem_autoria SEPARATOR '; ') AS autores,
    c.nome_categoria AS categoria,
    e.nome_editora AS editora,
    l.ano_publicacao,
    COUNT(ex.id_exemplar) AS total_exemplares,
    SUM(CASE WHEN ex.status = 'Dispon√≠vel' THEN 1 ELSE 0 END) AS exemplares_disponiveis,
    SUM(CASE WHEN ex.status = 'Emprestado' THEN 1 ELSE 0 END) AS exemplares_emprestados
FROM
    Livros l
    INNER JOIN Categorias c ON l.id_categoria = c.id_categoria
    LEFT JOIN Editoras e ON l.id_editora = e.id_editora
    LEFT JOIN LivrosAutores la ON l.id_livro = la.id_livro
    LEFT JOIN Autores a ON la.id_autor = a.id_autor
    INNER JOIN Exemplares ex ON l.id_livro = ex.id_livro
GROUP BY
    l.id_livro, l.isbn, l.titulo, c.nome_categoria, e.nome_editora, l.ano_publicacao
HAVING
    exemplares_disponiveis > 0
ORDER BY
    c.nome_categoria, l.titulo
--------------

Query OK, 0 rows affected (0,002 sec)

--------------
DROP VIEW IF EXISTS vw_UsuariosComPendencias
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE OR REPLACE VIEW vw_UsuariosComPendencias AS
SELECT
    u.id_usuario,
    u.cpf,
    u.nome_completo,
    u.email,
    u.telefone,
    tu.nome_tipo AS tipo_usuario,
    COUNT(DISTINCT CASE
        WHEN e.status_emprestimo = 'Ativo'
        AND e.data_prevista_devolucao < CURDATE()
        THEN e.id_emprestimo
    END) AS emprestimos_atrasados,
    IFNULL(SUM(CASE
        WHEN e.status_emprestimo = 'Ativo'
        AND e.data_prevista_devolucao < CURDATE()
        THEN DATEDIFF(CURDATE(), e.data_prevista_devolucao)
        ELSE 0
    END), 0) AS total_dias_atraso,
    COUNT(DISTINCT CASE
        WHEN m.status_pagamento = 'Pendente'
        THEN m.id_multa
    END) AS multas_pendentes,
    IFNULL(SUM(CASE
        WHEN m.status_pagamento = 'Pendente'
        THEN m.valor_multa
        ELSE 0
    END), 0.00) AS valor_total_multas,
    CASE
        WHEN MAX(DATEDIFF(CURDATE(), e.data_prevista_devolucao)) > 30 THEN 'Cr√≠tico'
        WHEN MAX(DATEDIFF(CURDATE(), e.data_prevista_devolucao)) > 14 THEN 'Aten√ß√£o'
        ELSE 'Regular'
    END AS status_conta
FROM
    Usuarios u
    INNER JOIN TiposUsuario tu ON u.id_tipo_usuario = tu.id_tipo_usuario
    LEFT JOIN Emprestimos e ON u.id_usuario = e.id_usuario
    LEFT JOIN Multas m ON e.id_emprestimo = m.id_emprestimo
GROUP BY
    u.id_usuario, u.cpf, u.nome_completo, u.email, u.telefone, tu.nome_tipo
HAVING
    emprestimos_atrasados > 0 OR multas_pendentes > 0
ORDER BY
    valor_total_multas DESC, total_dias_atraso DESC
--------------

Query OK, 0 rows affected (0,002 sec)

--------------
DROP VIEW IF EXISTS vw_EstatisticERROR 1351 (HY000) at line 166: View's SELECT contains a variable or parameter
asGerais
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE OR REPLACE VIEW vw_EstatisticasGerais AS
SELECT
    (SELECT COUNT(*) FROM Livros) AS total_livros,
    (SELECT COUNT(*) FROM Exemplares) AS total_exemplares,
    (SELECT COUNT(*) FROM Usuarios WHERE status = 'Ativo') AS total_usuarios,
    (SELECT COUNT(*) FROM Emprestimos WHERE status_emprestimo = 'Ativo') AS emprestimos_ativos,
    (SELECT COUNT(*) FROM Emprestimos
     WHERE status_emprestimo = 'Ativo'
     AND data_prevista_devolucao < CURDATE()) AS emprestimos_atrasados,
    (SELECT IFNULL(SUM(valor_multa), 0.00) FROM Multas
     WHERE status_pagamento = 'Pendente') AS multas_pendentes_total,
    ROUND(
        (SELECT COUNT(*) FROM Exemplares WHERE status = 'Emprestado') * 100.0 /
        (SELECT COUNT(*) FROM Exemplares),
        2
    ) AS taxa_ocupacao_percentual
--------------

Query OK, 0 rows affected (0,004 sec)

--------------
DROP VIEW IF EXISTS vw_RankingCategoriasMaisEmprestadas
--------------

Query OK, 0 rows affected, 1 warning (0,000 sec)

--------------
CREATE OR REPLACE VIEW vw_RankingCategoriasMaisEmprestadas AS
SELECT
    @posicao := @posicao + 1 AS posicao,
    c.nome_categoria AS categoria,
    COUNT(e.id_emprestimo) AS total_emprestimos,
    COUNT(DISTINCT l.id_livro) AS livros_categoria,
    ROUND(COUNT(e.id_emprestimo) / COUNT(DISTINCT l.id_livro), 2) AS media_emprestimos_por_livro
FROM
    Categorias c
    INNER JOIN Livros l ON c.id_categoria = l.id_categoria
    INNER JOIN Exemplares ex ON l.id_livro = ex.id_livro
    INNER JOIN Emprestimos e ON ex.id_exemplar = e.id_exemplar
    CROSS JOIN (SELECT @posicao := 0) AS pos_init
GROUP BY
    c.id_categoria, c.nome_categoria
ORDER BY
    total_emprestimos DESC
--------------

Bye
[0;31m[2025-11-17 15:34:44] ‚úó Erro ao importar 05_biblioteca_views.sql[0m
[0;31m[2025-11-17 15:34:44] Verifique o log: importacao_20251117_153440.log[0m
